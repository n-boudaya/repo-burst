{"version":3,"file":"bundle.js","sources":["index.js"],"sourcesContent":["import * as d3 from 'd3';\n\nd3.csv(\"flare_depends.csv\").then(function (data) {\n\n  const svg = d3.select(\"body\").append(\"svg\").attr('width', window.innerHeight).attr('height', window.innerHeight);\n\n  console.log(data);\n\n  svg.node().appendChild(chord_dependency(data));\n\n});\n\nfunction autoBox() {\n  document.body.appendChild(this);\n  const {x, y, width, height} = this.getBBox();\n  document.body.removeChild(this);\n  return [x, y, width, height];\n}\n\nfunction chord_dependency(data)\n{\n  console.log(data);\n\n  const width = 1080;\n  const height = width;\n  const innerRadius = Math.min(width, height) * 0.5 - 90;\n  const outerRadius = innerRadius + 10;\n\n  \n  // Compute a dense matrix from the weighted links in data.\n  const names = d3.sort(d3.union(data.map(d => d.source), data.map(d => d.target)));\n  const index = new Map(names.map((name, i) => [name, i]));\n  const matrix = Array.from(index, () => new Array(names.length).fill(0));\n  for (const {source, target, value} of data) matrix[index.get(source)][index.get(target)] += value;\n\n  console.log(matrix);\n\n  const chord = d3.chordDirected()\n      .padAngle(10 / innerRadius)\n      .sortSubgroups(d3.descending)\n      .sortChords(d3.descending);\n\n  const arc = d3.arc()\n      .innerRadius(innerRadius)\n      .outerRadius(outerRadius);\n\n  const ribbon = d3.ribbonArrow()\n      .radius(innerRadius - 1)\n      .padAngle(1 / innerRadius);\n\n  const colors = d3.quantize(d3.interpolateRainbow, names.length);\n\n  const svg = d3.create(\"svg\")\n      .attr(\"width\", width)\n      .attr(\"height\", height)\n      .attr(\"viewBox\", [-width / 2, -height / 2, width, height])\n      .attr(\"style\", \"width: 100%; height: auto; font: 10px sans-serif;\");\n\n  const chords = chord(matrix);\n\n  const group = svg.append(\"g\")\n    .selectAll()\n    .data(chords.groups)\n    .join(\"g\");\n\n  group.append(\"path\")\n      .attr(\"fill\", d => colors[d.index])\n      .attr(\"d\", arc);\n\n  group.append(\"text\")\n      .each(d => (d.angle = (d.startAngle + d.endAngle) / 2))\n      .attr(\"dy\", \"0.35em\")\n      .attr(\"transform\", d => `\n        rotate(${(d.angle * 180 / Math.PI - 90)})\n        translate(${outerRadius + 5})\n        ${d.angle > Math.PI ? \"rotate(180)\" : \"\"}\n      `)\n      .attr(\"text-anchor\", d => d.angle > Math.PI ? \"end\" : null)\n      .text(d => names[d.index]);\n\n  group.append(\"title\")\n      .text(d => `${names[d.index]}\n${d3.sum(chords, c => (c.source.index === d.index) * c.source.value)} outgoing →\n${d3.sum(chords, c => (c.target.index === d.index) * c.source.value)} incoming ←`);\n\n  svg.append(\"g\")\n      .attr(\"fill-opacity\", 0.75)\n    .selectAll()\n    .data(chords)\n    .join(\"path\")\n      .style(\"mix-blend-mode\", \"multiply\")\n      .attr(\"fill\", d => colors[d.target.index])\n      .attr(\"d\", ribbon)\n    .append(\"title\")\n      .text(d => `${names[d.source.index]} → ${names[d.target.index]} ${d.source.value}`);\n\n  console.log(svg.node());\n  return svg.attr(\"viewBox\", autoBox).node();\n}\n"],"names":["d3"],"mappings":"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"}