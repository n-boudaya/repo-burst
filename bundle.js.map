{"version":3,"file":"bundle.js","sources":["index.js"],"sourcesContent":["import * as d3 from 'd3';\n\nd3.json(\"dependencies_2024-11-09-12-16-10.json\").then(function (data) {\n\n    const svg = d3.select(\"body\").append(\"svg\").attr('width', window.innerHeight).attr('height', window.innerHeight);\n\n    svg.node().appendChild(singleDependencyChart(hierarchy(data)));\n\n});\n\nfunction autoBox() {\n    document.body.appendChild(this);\n    const {x, y, width, height} = this.getBBox();\n    document.body.removeChild(this);\n    return [x, y, width, height];\n}\n\nfunction singleDependencyChart(data)\n{\n    const width = 954;\n    const radius = width / 2;\n\n    const colorin = \"#00f\";\n    const colorout = \"#f00\";\n    const colornone = \"#ccc\";\n\n    const tree = d3.cluster()\n        .size([2 * Math.PI, radius - 100]);\n    const root = tree(bilink(d3.hierarchy(data)\n        .sort((a, b) => d3.ascending(a.height, b.height) || d3.ascending(a.data.path, b.data.path))));\n\n    const svg = d3.create(\"svg\")\n        .attr(\"width\", width)\n        .attr(\"height\", width)\n        .attr(\"viewBox\", [-width / 2, -width / 2, width, width])\n        .attr(\"style\", \"max-width: 100%; height: auto; font: 10px sans-serif;\");\n\n    const node = svg.append(\"g\")\n        .selectAll()\n        .data(root.leaves())\n        .join(\"g\")\n        .attr(\"transform\", d => `rotate(${d.x * 180 / Math.PI - 90}) translate(${d.y},0)`)\n        .append(\"text\")\n        .attr(\"dy\", \"0.31em\")\n        .attr(\"x\", d => d.x < Math.PI ? 6 : -6)\n        .attr(\"text-anchor\", d => d.x < Math.PI ? \"start\" : \"end\")\n        .attr(\"transform\", d => d.x >= Math.PI ? \"rotate(180)\" : null)\n        .text(d => d.data.path)\n        .each(function(d) { d.text = this; })\n        .on(\"mouseover\", overed)\n        .on(\"mouseout\", outed)\n        .call(text => text.append(\"title\").text(d => `${id(d)}\n${d.outgoing.length} outgoing\n${d.incoming.length} incoming`));\n\n    const line = d3.lineRadial()\n        .curve(d3.curveBundle.beta(0.85))\n        .radius(d => d.y)\n        .angle(d => d.x);\n\n    const link = svg.append(\"g\")\n        .attr(\"stroke\", colornone)\n        .attr(\"fill\", \"none\")\n        .selectAll()\n        .data(root.leaves().flatMap(leaf => leaf.outgoing))\n        .join(\"path\")\n        .style(\"mix-blend-mode\", \"multiply\")\n        .attr(\"d\", ([i, o]) => line(i.path(o)))\n        .each(function(d) { d.path = this; });\n\n    function overed(event, d) {\n        link.style(\"mix-blend-mode\", null);\n        d3.select(this).attr(\"font-weight\", \"bold\");\n        d3.selectAll(d.incoming.map(d => d.path)).attr(\"stroke\", colorin).raise();\n        d3.selectAll(d.incoming.map(([d]) => d.text)).attr(\"fill\", colorin).attr(\"font-weight\", \"bold\");\n        d3.selectAll(d.outgoing.map(d => d.path)).attr(\"stroke\", colorout).raise();\n        d3.selectAll(d.outgoing.map(([, d]) => d.text)).attr(\"fill\", colorout).attr(\"font-weight\", \"bold\");\n    }\n\n    function outed(event, d) {\n        link.style(\"mix-blend-mode\", \"multiply\");\n        d3.select(this).attr(\"font-weight\", null);\n        d3.selectAll(d.incoming.map(d => d.path)).attr(\"stroke\", null);\n        d3.selectAll(d.incoming.map(([d]) => d.text)).attr(\"fill\", null).attr(\"font-weight\", null);\n        d3.selectAll(d.outgoing.map(d => d.path)).attr(\"stroke\", null);\n        d3.selectAll(d.outgoing.map(([, d]) => d.text)).attr(\"fill\", null).attr(\"font-weight\", null);\n    }\n\n    return svg.node();\n}\n\nfunction hierarchy(data, delimiter = \"\\\\\") {\n    // console.log(data);\n\n    let root;\n    const map = new Map;\n    data.forEach(function find(data) {\n        const {path} = data;\n        if (map.has(path)) return map.get(path);\n        const i = path.lastIndexOf(delimiter);\n        map.set(path, data);\n        if (i >= 0) {\n            find({path: path.substring(0, i), children: []}).children.push(data);\n            data.path = path.substring(i + 1);\n        } else {\n            root = data;\n        }\n        return data;\n    });\n\n    // console.log(root);\n    return root;\n}\n\nfunction bilink(root) {\n\n    // for (const d of root.leaves()){\n    //     // console.log(d3.map(d.data.dependencies, (d)=> d.file));\n    //     // console.log(d3.filter(d.data.dependencies, (d)=>d.external===false));\n    //\n    //     console.log(d3.map(d3.filter(d.data.dependencies, (d)=>d.external===false), (d)=> d.file));\n    //\n    // }\n    // for (const d of root.leaves()){\n    //     console.log(d);\n    //     console.log(id(d));\n    // }\n\n    const map = new Map(root.leaves().map(d => [id(d), d]));\n    console.log(map);\n\n    for (const d of root.leaves()){\n        console.log(d3.map(d3.filter(d.data.dependencies, (d)=>d.external===false), (d)=> d.file));\n    }\n    for (const d of root.leaves()){\n        d.incoming = [];\n        d.outgoing = d3.map(d3.filter(d.data.dependencies, (d)=>d.external===false), (d)=> d.file).map(i => [d, map.get(i)]);\n    }\n    // for (const d of root.leaves()) for (const o of d.outgoing) console.log(o);\n    for (const d of root.leaves()) for (const o of d.outgoing) o[1].incoming.push(o);\n    return root;\n}\n\nfunction id(node) {\n    const output = `${node.parent ? id(node.parent) + \"\\\\\" : \"\"}${node.data.path}`;\n\n    // console.log(node);\n    // console.log(output);\n\n    return output;\n}\n"],"names":["d3"],"mappings":"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"}